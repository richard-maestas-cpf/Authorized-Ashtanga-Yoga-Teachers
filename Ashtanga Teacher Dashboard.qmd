---
title: "Ashtanga Yoga Authorized Teachers "
format: 
  dashboard:
    nav-buttons: [github]
    github: https://github.com/richard-maestas-cpf/Authorized-Ashtanga-Yoga-Teachers

---

```{r, message=FALSE, warning=FALSE, include=FALSE} 
                                     # Set up and libraries
library(tidyverse)
library(gt)
library(scales)
library(plotly)

setwd('outputs')
teacher_data <- readRDS("teacher_data.rds")

```

# Authorization Level

```{r}
#| title: Authorized teachers by institution and level
# ensure consistent factor order
lvl_order <- c("Level 1","Level 2","Certified")

auth_level <- bind_rows(
  teacher_data %>%
    transmute(institution = "SYC",
              level = factor(syc_authorization_level, levels = lvl_order),
              authorized = syc_authorized),
  teacher_data %>%
    transmute(institution = "KPJAY",
              level = factor(kpjay_authorization_level, levels = lvl_order),
              authorized = kpjay_authorized)
) %>%
  filter(authorized == "Yes") %>%                    # keep only authorized teachers
  count(institution, level, name = "n") %>%
  complete(institution, level, fill = list(n = 0))   # fill missing combos with 0

# Plot: side-by-side facets, x=level, y=count
p2 <- ggplot(auth_level, aes(x = level, y = n, fill = level)) +
  geom_col() +
  facet_wrap(~ institution, nrow = 1) +
  labs(
    x = "Authorization level",
    y = "Count",
    title = ""
  ) +
  scale_fill_manual(
    values = c("Level 1" = "Light Blue", 
               "Level 2" = "Steel Blue", 
               "Certified" = "Dark Gray")
  ) +
  theme_minimal()

ggplotly(p2)

```
# Country

```{r, scrolling="true"}
#| title: Number of Teachers by Country
country_data <- teacher_data %>% 
  group_by(country) %>% 
  summarise(count = n(), .groups = "drop") %>% 
  mutate(country = fct_reorder(country, count))

p1 <- ggplot(country_data, aes(x = country, y = count)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(
    #title = "Number of Yoga Teachers by Country",
    x = " ",
    y = "Number of Authorized Teachers"
  ) +
  theme_minimal()

ggplotly(p1)

```

# Teacher Data

```{r, scrolling="true"}
#| title: Teacher Name and Data
head(teacher_data, 10) %>% gt() #replace with full data set when dashboard finalized
```
